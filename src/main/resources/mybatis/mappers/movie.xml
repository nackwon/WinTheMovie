<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="movie"> <!--클래스명은 xml명과 똑같을 필요 없음 -->

	<!-- 쿼리문 작성 -->
	<select id="getTheaterList" resultType="nowpVo">
    	<![CDATA[
			select  n.nowplayingno, 
    				n.roomno, 
    				n.movieno, 
    				to_char(n.playingtime,'YYYY-MM-DD HH24:MI:SS') as playingtime, 
    				to_char(n.playingdate,'YYYY-MM-DD') as playingdate, 
    				m.poster, 
    				tr.theaterno, 
    				t.brandno, 
    				t.theatername,
					t.theateraddress, 
					t.theaterxgps, 
					t.theaterygps, 
					b.brandlogo, 
					b.brandname
			from nowplaying n, movie m, THEATERROOM tr, theater t, brand b
			where  n.movieno = m.movieno and n.roomno = tr.roomno and tr.theaterno = t.theaterno and t.brandno = b.brandno
			and (n.playingtime - sysdate) *24*60*60 > 0 
			and n.playingtime between to_date(concat(to_char(sysdate, 'yyyy-mm-dd'), '04:00:01'), 'yyyy-mm-dd hh24:mi:ss')
			and to_date(concat(to_char(sysdate+1, 'yyyy-mm-dd'), '04:00:00'), 'yyyy-mm-dd hh24:mi:ss')
			and to_char(n.playingtime,'YYYY-MM-DD') = to_char(n.playingdate,'YYYY-MM-DD')
			order by n.playingtime asc			
	 ]]>	
    </select> 

</mapper>